# MrDoc DSM 部署任务说明

## 📋 任务概述

将MrDoc文档管理系统部署到群晖DSM服务器上，使用Docker方式部署。

## 🎯 任务目标

在群晖DSM服务器上成功部署MrDoc系统，确保：
- ✅ 系统可以正常访问
- ✅ 包含的128篇文档和29个文集完整导入
- ✅ 搜索功能正常工作
- ✅ API接口可以正常调用

## 📦 交付物

已准备好的部署包：`/tmp/mrdoc-docker-dsm-20251030.tar.gz`（27MB）

包含内容：
- MrDoc完整源代码
- Docker配置文件（Dockerfile.dsm, docker-compose-dsm.yml）
- 数据库数据文件（mrdoc_data.json，2.8MB）
- 完整部署文档（DSM部署指南.md）
- API使用说明文档

## 👨‍💼 任务要求

### 技能要求
- 熟悉群晖DSM系统操作
- 了解Docker和Docker Compose基础
- 能够使用SSH连接服务器
- 基础的Linux命令行操作能力

### 需要的访问权限
- DSM管理员账号
- SSH访问权限
- Docker套件管理权限

## 📝 部署步骤（简要）

### 1. 获取部署包
- 从 `/tmp/mrdoc-docker-dsm-20251030.tar.gz` 获取部署包
- 上传到DSM的共享文件夹

### 2. 解压部署包
- SSH登录DSM
- 解压到 `/volume1/docker/mrdoc` 目录

### 3. 启动容器
```bash
cd /volume1/docker/mrdoc/mrdoc-docker-dsm-20251030
sudo docker-compose -f docker-compose-dsm.yml up -d
```

### 4. 验证部署
- 访问 `http://DSM地址:8000`
- 使用 admin / admin123 登录
- 确认可以看到文档和文集
- 测试搜索功能

### 5. 测试API
```bash
curl "http://localhost:8000/api/search_content/?token=43c395f68784452784585da896cb5c66&pattern=CDP&search_mode=exact&limit=1"
```

## 📖 详细文档

所有详细的部署步骤、配置说明、故障排查都在 `DSM部署指南.md` 中，请仔细阅读。

部署指南包含：
- ✅ 两种部署方法（Docker Compose 和 DSM图形界面）
- ✅ 详细的步骤说明和截图指引
- ✅ 常见问题解答（FAQ）
- ✅ 故障排查步骤
- ✅ 维护命令参考

## ✅ 验收标准

### 必须完成
1. [ ] MrDoc系统可以通过浏览器正常访问
2. [ ] 使用 admin / admin123 可以成功登录
3. [ ] 可以看到29个文集
4. [ ] 可以看到128篇文档
5. [ ] 搜索功能正常工作
6. [ ] API接口可以正常调用并返回正确结果

### 加分项
- [ ] 配置反向代理实现HTTPS访问
- [ ] 设置DSM防火墙规则
- [ ] 配置自动备份
- [ ] 提供部署过程中遇到的问题和解决方案

## 📊 系统信息

部署完成后的系统信息：

| 项目 | 信息 |
|-----|------|
| 访问地址 | http://DSM地址:8000 |
| 管理员账号 | admin |
| 管理员密码 | admin123 |
| API Token | 43c395f68784452784585da896cb5c66 |
| 文档数量 | 128篇 |
| 文集数量 | 29个 |
| 文集权限 | 所有文集已设为私密 |
| 容器名称 | mrdoc-dsm |
| 镜像名称 | mrdoc-dsm:latest |

## 🚨 重要提示

### 数据持久化
容器使用以下目录持久化数据：
- `./data/db` - 数据库文件
- `./data/media` - 媒体文件
- `./data/log` - 日志文件
- `./data/whoosh_index` - 搜索索引

**这些目录非常重要，不能删除！**

### 首次启动
首次启动时，容器会自动：
1. 初始化数据库
2. 导入128篇文档和29个文集
3. 构建搜索索引

这个过程大约需要1-2分钟，请耐心等待。

### 端口冲突
如果8000端口已被占用，可以修改 `docker-compose-dsm.yml` 中的端口映射：
```yaml
ports:
  - "8080:8000"  # 改为其他端口
```

## 📞 支持和反馈

### 如遇到问题
1. 首先查看容器日志：
   ```bash
   sudo docker logs mrdoc-dsm
   ```

2. 参考 `DSM部署指南.md` 中的"常见问题"部分

3. 如果问题无法解决，请记录：
   - 错误信息
   - 容器日志
   - 操作步骤
   - DSM版本信息

### 完成后提交
部署完成后，请提供：
1. 访问地址（如 http://192.168.1.100:8000）
2. 部署截图（登录页面、文档列表）
3. API测试结果
4. 遇到的问题和解决方案（如有）

## ⏱️ 预计时间

- 熟悉文档和准备：15分钟
- 上传和解压文件：10分钟
- 部署和启动容器：10分钟
- 测试和验证：15分钟

**总计：约50分钟**

## 🎓 学习资源

如果对Docker或DSM不熟悉，建议先学习：
- 群晖DSM Docker套件使用教程
- Docker Compose基础教程
- 部署包中的 `DSM部署指南.md`

## 📝 检查清单

部署前检查：
- [ ] 已获取部署包（27MB tar.gz文件）
- [ ] 已阅读 DSM部署指南.md
- [ ] 确认DSM已安装Docker套件
- [ ] 确认有SSH访问权限
- [ ] 确认8000端口未被占用

部署后检查：
- [ ] 容器状态为Running
- [ ] 可以访问Web界面
- [ ] 可以登录系统
- [ ] 文档和文集显示正常
- [ ] 搜索功能正常
- [ ] API可以正常调用

---

## 🚀 开始部署

请仔细阅读 `DSM部署指南.md`，然后开始部署任务。

祝部署顺利！

---

**任务创建日期**: 2025-10-30
**部署包版本**: mrdoc-docker-dsm-20251030
**MrDoc版本**: 0.9.6
