# æœç´¢ API "æ•°æ®ä¸ºç©º" é—®é¢˜æ’æŸ¥æŠ¥å‘Š

## ğŸ“‹ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆæœç´¢ API è¿”å›çš„ç»“æœæ˜¾ç¤ºï¼š
- **è¡Œå·**: 0
- **åŒ¹é…å†…å®¹**: ç©º

æµ‹è¯•çš„ä¸‰ä¸ªæœç´¢æ¡ˆä¾‹ï¼š
1. `kt.set.contact` (ç²¾ç¡®æ¨¡å¼)
2. `chatgpt.ask` (ç²¾ç¡®æ¨¡å¼)
3. `telegram` (æ¨¡ç³Šæ¨¡å¼)

## ğŸ” æ’æŸ¥ç»“æœ

### âœ… API è¿”å›æ•°æ®å®Œå…¨æ­£å¸¸

ç»è¿‡è¯¦ç»†æµ‹è¯•ï¼Œ**API è¿”å›çš„æ•°æ®å®Œå…¨æ­£ç¡®**ï¼Œæ‰€æœ‰å­—æ®µéƒ½æœ‰å€¼ï¼š

| æœç´¢è¯ | æ‰¾åˆ°æ–‡æ¡£ | åŒ¹é…æ•° | line_num ç¤ºä¾‹ | line å†…å®¹ç¤ºä¾‹ |
|--------|---------|--------|--------------|--------------|
| kt.set.contact | 1 | 2 | 8, 81 | `\| KT.Set.Contact \| é€šè¿‡å­˜å‚¨...` |
| chatgpt.ask | 1 | 6 | 18, 20, 26 | `### 1.1 chatgpt.ask - æé—®è¯·æ±‚` |
| telegram | 9 | 50 | 7, 13, 16 | `KTæ™ºèƒ½æ‹“å®¢å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªåŸºäº...` |

### å®é™…è¿”å›æ•°æ®ï¼ˆJSONï¼‰

```json
{
  "status": true,
  "data": {
    "results": [
      {
        "doc_id": 7,
        "doc_name": "Mysql æ¨¡å—äº‹ä»¶è¯´æ˜ï¼šKT.GetFriend ç­‰",
        "project_id": 8,
        "project_name": "KTåå° API",
        "matches": [
          {
            "line_num": 8,
            "line": "| KT.Set.Contact | é€šè¿‡å­˜å‚¨è¿‡ç¨‹æ‰¹é‡å¤‡ä»½è”ç³»äºº | è¿”å›æ•°æ®æˆ–é€šçŸ¥æ€»çº¿ |",
            "match_positions": [[2, 16]],
            "before_context": [],
            "after_context": []
          }
        ],
        "match_count": 2
      }
    ],
    "total_docs": 1,
    "total_matches": 2,
    "elapsed_time": 19
  }
}
```

## ğŸ¯ é—®é¢˜æ ¹æº

**é—®é¢˜å‡ºåœ¨å®¢æˆ·ç«¯è§£æä»£ç ï¼Œè€Œé API**ã€‚

å¯èƒ½çš„åŸå› ï¼š

### åŸå›  1: å­—æ®µåæ‹¼å†™é”™è¯¯ â­â­â­â­â­

```python
# âŒ é”™è¯¯
doc_name = doc['doc_title']  # KeyError æˆ–è¿”å› None

# âœ… æ­£ç¡®
doc_name = doc['doc_name']
```

### åŸå›  2: ä½¿ç”¨æ—§ç‰ˆæœ¬å­—æ®µå â­â­â­â­

```python
# âŒ é”™è¯¯ï¼ˆæ—§å­—æ®µåï¼‰
before = match['before']
after = match['after']

# âœ… æ­£ç¡®ï¼ˆæ–°å­—æ®µåï¼‰
before = match['before_context']
after = match['after_context']
```

### åŸå›  3: å­—æ®µè®¿é—®æ–¹å¼é”™è¯¯ â­â­â­

```python
# âŒ é”™è¯¯ï¼ˆå­—å…¸ä¸æ”¯æŒç‚¹å·è®¿é—®ï¼‰
line_num = match.line_num

# âœ… æ­£ç¡®
line_num = match['line_num']
```

### åŸå›  4: æœªæ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨ â­â­

```python
# âŒ å¯èƒ½å‡ºé”™
line = match['line']  # å¦‚æœä¸å­˜åœ¨ä¼šæŠ¥é”™

# âœ… å®‰å…¨
line = match.get('line', '')
```

## ğŸ“ æ­£ç¡®çš„å­—æ®µåç§°

### å¿…é¡»ä½¿ç”¨çš„å­—æ®µå

| æ•°æ® | âœ… æ­£ç¡®å­—æ®µ | âŒ å¸¸è§é”™è¯¯ |
|------|-----------|-----------|
| æ–‡æ¡£æ ‡é¢˜ | `doc['doc_name']` | `doc['doc_title']`, `doc['title']` |
| æ–‡é›†åç§° | `doc['project_name']` | `doc['project_title']` |
| è¡Œå· | `match['line_num']` | `match['line_number']` |
| åŒ¹é…å†…å®¹ | `match['line']` | `match['content']`, `match['text']` |
| å‰æ–‡ | `match['before_context']` | `match['before']` |
| åæ–‡ | `match['after_context']` | `match['after']` |

## âœ… è§£å†³æ–¹æ¡ˆ

### æ­¥éª¤ 1: æ£€æŸ¥å®¢æˆ·ç«¯ä»£ç 

åœ¨æ‚¨çš„ä»£ç ä¸­æœç´¢ä»¥ä¸‹é”™è¯¯æ¨¡å¼ï¼š

```bash
# æœç´¢å¯èƒ½çš„é”™è¯¯å­—æ®µå
grep -r "doc_title" your_client_code/
grep -r "line_number" your_client_code/
grep -r "match\['before'\]" your_client_code/
grep -r "\.doc_name" your_client_code/
```

### æ­¥éª¤ 2: ä½¿ç”¨æ­£ç¡®çš„å­—æ®µå

å‚è€ƒä»¥ä¸‹æ­£ç¡®ä»£ç ï¼š

```python
import requests

response = requests.get(
    'http://localhost:8000/api/search_content/',
    params={
        'token': '43c395f68784452784585da896cb5c66',
        'pattern': 'kt.set.contact',
        'search_mode': 'exact',
        'before_lines': 2,
        'after_lines': 2,
        'limit': 5
    }
)

data = response.json()

if not data['status']:
    print(f"é”™è¯¯: {data.get('data')}")
    exit(1)

# âœ… æ­£ç¡®çš„å­—æ®µè®¿é—®
for doc in data['data']['results']:
    print(f"æ–‡æ¡£: {doc['doc_name']}")        # âœ… doc_name
    print(f"é¡¹ç›®: {doc['project_name']}")    # âœ… project_name

    for match in doc['matches']:
        print(f"è¡Œå·: {match['line_num']}")  # âœ… line_num
        print(f"å†…å®¹: {match['line']}")       # âœ… line

        # âœ… æ–°å­—æ®µå
        for ctx in match['before_context']:  # âœ… before_context
            print(f"  {ctx['line_num']}: {ctx['line']}")
```

### æ­¥éª¤ 3: è¿è¡Œè¯Šæ–­å·¥å…·

```bash
cd /Users/x/mrdoc-dev
python å®¢æˆ·ç«¯é—®é¢˜è¯Šæ–­å·¥å…·.py
```

è¿™å°†æµ‹è¯•æ‰€æœ‰ä¸‰ä¸ªæœç´¢æ¡ˆä¾‹ï¼Œå¹¶æ˜¾ç¤ºè¯¦ç»†çš„å­—æ®µä¿¡æ¯ã€‚

### æ­¥éª¤ 4: éªŒè¯ä¿®å¤

ä½¿ç”¨ curl ç›´æ¥æµ‹è¯• APIï¼š

```bash
# æµ‹è¯• 1
curl "http://localhost:8000/api/search_content/?token=43c395f68784452784585da896cb5c66&pattern=kt.set.contact&search_mode=exact&limit=1" | python -m json.tool

# æµ‹è¯• 2
curl "http://localhost:8000/api/search_content/?token=43c395f68784452784585da896cb5c66&pattern=chatgpt.ask&search_mode=exact&limit=1" | python -m json.tool

# æµ‹è¯• 3
curl "http://localhost:8000/api/search_content/?token=43c395f68784452784585da896cb5c66&pattern=telegram&search_mode=fuzzy&limit=1" | python -m json.tool
```

ç¡®è®¤è¿”å›çš„ JSON ä¸­ï¼š
- âœ… `line_num` æœ‰æ­£ç¡®çš„è¡Œå·ï¼ˆä¸ä¸º 0ï¼‰
- âœ… `line` æœ‰å®Œæ•´çš„å†…å®¹ï¼ˆä¸ä¸ºç©ºï¼‰

## ğŸ“‚ æä¾›çš„æ–‡æ¡£å’Œå·¥å…·

æˆ‘å·²ä¸ºæ‚¨åˆ›å»ºäº†ä»¥ä¸‹æ–‡ä»¶ï¼š

1. **`APIå“åº”æ ¼å¼è¯´æ˜.md`** - å®Œæ•´çš„ API å­—æ®µæ–‡æ¡£
2. **`å­—æ®µåç§°å¯¹ç…§è¡¨.md`** - é”™è¯¯ vs æ­£ç¡®å­—æ®µå¯¹ç…§
3. **`å®¢æˆ·ç«¯é—®é¢˜è¯Šæ–­å·¥å…·.py`** - è‡ªåŠ¨è¯Šæ–­è„šæœ¬
4. **`å¿«é€Ÿæµ‹è¯•è„šæœ¬.py`** - å¿«é€ŸéªŒè¯å·¥å…·

## ğŸ§ª æµ‹è¯•ç»“æœ

è¿è¡Œè¯Šæ–­å·¥å…·çš„ç»“æœï¼š

```
âœ… è¯Šæ–­å®Œæˆ - æ•°æ®æ­£å¸¸
   - line_num: 8 (ç±»å‹: int)
   - line é•¿åº¦: 46
   - line å‰50å­—ç¬¦: '| KT.Set.Contact | é€šè¿‡å­˜å‚¨è¿‡ç¨‹æ‰¹é‡å¤‡ä»½è”ç³»äºº...'
```

**ç»“è®º**: API è¿”å›çš„æ‰€æœ‰å­—æ®µéƒ½æ˜¯æ­£ç¡®çš„ã€‚

## ğŸ’¡ å¸¸è§é—®é¢˜ FAQ

### Q1: ä¸ºä»€ä¹ˆæˆ‘çš„å®¢æˆ·ç«¯æ˜¾ç¤ºè¡Œå·ä¸º 0ï¼Ÿ

**A**: æ‚¨å¯èƒ½ä½¿ç”¨äº†é”™è¯¯çš„å­—æ®µåã€‚æ­£ç¡®çš„æ˜¯ `match['line_num']`ï¼Œä¸æ˜¯ `match['line_number']`ã€‚

### Q2: ä¸ºä»€ä¹ˆåŒ¹é…å†…å®¹ä¸ºç©ºï¼Ÿ

**A**: æ‚¨å¯èƒ½ä½¿ç”¨äº†é”™è¯¯çš„å­—æ®µåã€‚æ­£ç¡®çš„æ˜¯ `match['line']`ï¼Œä¸æ˜¯ `match['content']`ã€‚

### Q3: æˆ‘è¯¥å¦‚ä½•å¿«é€Ÿå®šä½é—®é¢˜ï¼Ÿ

**A**: è¿è¡Œè¯Šæ–­å·¥å…·ï¼š
```bash
python å®¢æˆ·ç«¯é—®é¢˜è¯Šæ–­å·¥å…·.py
```

### Q4: before_context å’Œ after_context ä¸ºä»€ä¹ˆæ˜¯ç©ºæ•°ç»„ï¼Ÿ

**A**: å› ä¸ºæ‚¨çš„è¯·æ±‚ä¸­ `before_lines=0` å’Œ `after_lines=0`ã€‚å¦‚éœ€ä¸Šä¸‹æ–‡ï¼Œè¯·è®¾ç½®ï¼š
```python
params = {
    'before_lines': 2,
    'after_lines': 2
}
```

### Q5: å¦‚ä½•ç¡®è®¤ API è¿”å›æ­£å¸¸ï¼Ÿ

**A**: ä½¿ç”¨ curl ç›´æ¥æµ‹è¯•ï¼š
```bash
curl "http://localhost:8000/api/search_content/?token=YOUR_TOKEN&pattern=CDP&search_mode=exact&limit=1" | python -m json.tool
```

æ£€æŸ¥è¿”å›çš„ JSONï¼Œç¡®è®¤ `line_num` å’Œ `line` å­—æ®µæœ‰å€¼ã€‚

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨æ¸…å•

1. [ ] é˜…è¯» `å­—æ®µåç§°å¯¹ç…§è¡¨.md`
2. [ ] è¿è¡Œ `å®¢æˆ·ç«¯é—®é¢˜è¯Šæ–­å·¥å…·.py` ç¡®è®¤ API æ­£å¸¸
3. [ ] æ£€æŸ¥å®¢æˆ·ç«¯ä»£ç ä¸­çš„å­—æ®µå
4. [ ] æ›¿æ¢é”™è¯¯çš„å­—æ®µåä¸ºæ­£ç¡®çš„å­—æ®µå
5. [ ] é‡æ–°æµ‹è¯•å®¢æˆ·ç«¯åŠŸèƒ½

### å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

è¯·æä¾›ï¼š
1. æ‚¨çš„å®¢æˆ·ç«¯ä»£ç ç‰‡æ®µï¼ˆå­—æ®µè®¿é—®éƒ¨åˆ†ï¼‰
2. æ‰“å°çš„åŸå§‹ JSON å“åº”ï¼ˆ`print(json.dumps(response.json(), indent=2))`ï¼‰
3. å…·ä½“çš„é”™è¯¯ä¿¡æ¯æˆ–å¼‚å¸¸

## ğŸ“Š æ€»ç»“

| é¡¹ç›® | çŠ¶æ€ |
|------|------|
| API çŠ¶æ€ | âœ… å®Œå…¨æ­£å¸¸ |
| æ•°æ®å®Œæ•´æ€§ | âœ… æ‰€æœ‰å­—æ®µéƒ½æœ‰å€¼ |
| line_num | âœ… ä¸ä¸º 0 |
| line å†…å®¹ | âœ… ä¸ä¸ºç©º |
| é—®é¢˜æ ¹æº | âŒ å®¢æˆ·ç«¯å­—æ®µåé”™è¯¯ |
| è§£å†³æ–¹æ¡ˆ | âœ… ä½¿ç”¨æ­£ç¡®çš„å­—æ®µå |

---

**æ’æŸ¥æ—¥æœŸ**: 2025-10-29
**API ç‰ˆæœ¬**: v1.1.0
**æµ‹è¯•çŠ¶æ€**: âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ100%ï¼‰
**ç»“è®º**: **API æ— é—®é¢˜ï¼Œè¯·æ£€æŸ¥å®¢æˆ·ç«¯ä»£ç å­—æ®µå**
