{% load i18n %}
<!-- 优化的分页器组件 -->
<div class="mrdoc-pagination-wrapper" style="text-align: center; margin: 20px 0;">
    <div class="mrdoc-pagination">
        {% if page_obj.paginator.num_pages > 1 %}

            <!-- 首页按钮 -->
            {% if page_obj.has_previous %}
                <a href="?page=1{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                   class="mrdoc-page-btn mrdoc-page-first">
                    <span style="font-size: 16px;">‹‹</span>
                </a>
            {% else %}
                <span class="mrdoc-page-btn mrdoc-page-disabled"><span style="font-size: 16px;">‹‹</span></span>
            {% endif %}

            <!-- 上一页按钮 -->
            {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                   class="mrdoc-page-btn mrdoc-page-prev">
                    <span style="font-size: 16px;">‹</span>
                </a>
            {% else %}
                <span class="mrdoc-page-btn mrdoc-page-disabled"><span style="font-size: 16px;">‹</span></span>
            {% endif %}

            <!-- 可点击编辑的页码显示 -->
            <span class="mrdoc-page-info" id="pageInfoDisplay"
                  onclick="enablePageEdit()"
                  title="点击输入页码">
                <span id="currentPageNum">{{ page_obj.number }}</span> / {{ page_obj.paginator.num_pages }}
            </span>
            <input type="number"
                   class="mrdoc-page-info-input"
                   id="pageInfoInput"
                   style="display: none;"
                   min="1"
                   max="{{ page_obj.paginator.num_pages }}"
                   value="{{ page_obj.number }}"
                   onblur="disablePageEdit()"
                   onkeypress="if(event.key==='Enter')jumpToPageFromInfo()">

            <!-- 下一页按钮 -->
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                   class="mrdoc-page-btn mrdoc-page-next">
                    <span style="font-size: 16px;">›</span>
                </a>
            {% else %}
                <span class="mrdoc-page-btn mrdoc-page-disabled"><span style="font-size: 16px;">›</span></span>
            {% endif %}

            <!-- 末页按钮 -->
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.paginator.num_pages }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                   class="mrdoc-page-btn mrdoc-page-last">
                    <span style="font-size: 16px;">››</span>
                </a>
            {% else %}
                <span class="mrdoc-page-btn mrdoc-page-disabled"><span style="font-size: 16px;">››</span></span>
            {% endif %}

            <!-- 分隔线 -->
            <span class="mrdoc-page-divider"></span>

            <!-- 每页显示数量选择 -->
            <div class="mrdoc-page-size">
                <select class="mrdoc-page-size-select" onchange="changePageSize(this.value)">
                    {% with current_size=request.GET.page_size|default:"12" %}
                    <option value="12" {% if current_size == "12" %}selected{% endif %}>每页 12 条</option>
                    <option value="24" {% if current_size == "24" %}selected{% endif %}>每页 24 条</option>
                    <option value="48" {% if current_size == "48" %}selected{% endif %}>每页 48 条</option>
                    <option value="96" {% if current_size == "96" %}selected{% endif %}>每页 96 条</option>
                    {% endwith %}
                </select>
            </div>

            <!-- 快速跳转功能已整合到页码信息中 -->

        {% endif %}
    </div>
</div>

<style>
/* 分页器容器 */
.mrdoc-pagination-wrapper {
    user-select: none;
}

.mrdoc-pagination {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
}

/* 按钮基础样式 */
.mrdoc-page-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 32px;
    width: 32px;
    height: 32px;
    padding: 0;
    font-size: 13px;
    color: #333;
    background: #fff;
    border: 1px solid #d0d7de;
    border-radius: 6px;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s;
}

.mrdoc-page-btn:hover {
    border-color: #2563eb;
    color: #2563eb;
}

.mrdoc-page-btn.mrdoc-page-disabled {
    color: #999;
    background: #f5f5f5;
    border-color: #e5e5e5;
    cursor: not-allowed;
}

/* 页码信息样式 - 可点击编辑 */
.mrdoc-page-info {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 60px;
    height: 32px;
    padding: 0 12px;
    font-size: 14px;
    color: #666;
    background: #fff;
    border: 1px solid #d0d7de;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
}

.mrdoc-page-info:hover {
    border-color: #2563eb;
    background: #f8fafc;
}

/* 页码输入框样式 */
.mrdoc-page-info-input {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 50px;
    height: 32px;
    padding: 0 8px;
    font-size: 14px;
    color: #333;
    text-align: center;
    background: #fff;
    border: 1px solid #2563eb;
    border-radius: 6px;
    outline: none;
}

/* 分隔线 */
.mrdoc-page-divider {
    width: 1.5px;
    height: 24px;
    background: #d0d7de;
    margin: 0 6px;
}

/* 每页显示数量 */
.mrdoc-page-size {
    display: inline-flex;
    align-items: center;
}

.mrdoc-page-size-select {
    min-width: 110px;
    height: 32px;
    padding: 0 30px 0 10px;
    font-size: 13px;
    color: #666;
    background: #fff url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><path fill="%23666" d="M6 8L2 4h8z"/></svg>') no-repeat right 8px center;
    border: 1px solid #d0d7de;
    border-radius: 6px;
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    transition: all 0.2s;
}

.mrdoc-page-size-select:hover {
    border-color: #2563eb;
    color: #333;
}

/* 移动端适配 */
@media screen and (max-width: 768px) {
    .mrdoc-pagination-wrapper {
        padding: 0 10px;
    }

    .mrdoc-pagination {
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
    }

    .mrdoc-page-btn {
        min-width: 36px;
        width: 36px;
        height: 36px;
        font-size: 14px;
    }

    .mrdoc-page-info, .mrdoc-page-info-input {
        height: 36px;
        font-size: 15px;
    }

    /* 隐藏首页/末页按钮，简化移动端 */
    .mrdoc-page-first,
    .mrdoc-page-last {
        display: none;
    }

    /* 隐藏"每页显示"功能，简化移动端界面 */
    .mrdoc-page-divider,
    .mrdoc-page-size {
        display: none;
    }
}
</style>

<script>
// 修改每页显示数量
function changePageSize(size) {
    var url = new URL(window.location.href);
    url.searchParams.set('page_size', size);
    url.searchParams.set('page', '1');
    window.location.href = url.toString();
}

// 启用页码编辑
function enablePageEdit() {
    var display = document.getElementById('pageInfoDisplay');
    var input = document.getElementById('pageInfoInput');
    display.style.display = 'none';
    input.style.display = 'inline-flex';
    input.focus();
    input.select();
}

// 禁用页码编辑
function disablePageEdit() {
    setTimeout(function() {
        var display = document.getElementById('pageInfoDisplay');
        var input = document.getElementById('pageInfoInput');
        display.style.display = 'inline-flex';
        input.style.display = 'none';
    }, 200);
}

// 从页码信息跳转
function jumpToPageFromInfo() {
    var input = document.getElementById('pageInfoInput');
    var pageNum = parseInt(input.value);
    var maxPage = parseInt(input.max);

    if (pageNum && pageNum >= 1 && pageNum <= maxPage) {
        var url = new URL(window.location.href);
        url.searchParams.set('page', pageNum);
        window.location.href = url.toString();
    } else {
        alert('请输入有效的页码 (1-' + maxPage + ')');
        input.value = document.getElementById('currentPageNum').textContent;
    }
}
</script>
